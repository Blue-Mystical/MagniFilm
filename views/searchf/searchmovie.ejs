<%- include('../partials/header.ejs') %>

<div class="container py-4 mt-4 bg-secondary rounded-3">
    <div class="form-group mb-3 bg-primary border border-secondary rounded-3">
        <h1 class="display-5 fw-bold text-center py-1">Search Movies</h1>
        <hr class='dark-long mb-2'>

        <div class='row'>
            <form class="input-group" action="/search" method="GET">
                <div class='col-12 offset-0 col-md-8 offset-md-2 col-lg-6 offset-lg-3'>
                    <div class="form-outline d-flex pb-2 mx-2">
                        <input type="search" id="form1" name=value class="form-control form-control-sm"
                        placeholder='search' value='<% if (search.value) { %><%= search.value %><% } %>'>
                        <button type="submit" class="btn btn-primary btn-sm">
                          <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="form-group mb-2">
                        <div class="row">
                          <div class="col-4 ms-2 pe-1">
                            <select class="form-select" aria-label="sort" name="sort">
                              <option value="airdate" <% if (!search.sort) { %> selected <% } %> >Sort By</option>
                              <option value="airdate" <% if (search.sort == 'airdate') { %> selected <% } %> >Air date</option>
                              <option value="name" <% if (search.sort == 'name') { %> selected <% } %> >Title</option>
                              <option value="like" <% if (search.sort == 'like') { %> selected <% } %> >Like</option>
                              <option value="rating" <% if (search.sort == 'rating') { %> selected <% } %> >Avg. Rating</option>
                              <option value="length" <% if (search.sort == 'length') { %> selected <% } %> >Movie Length</option>
                            </select>
                          </div>
                          <div class="col-3 ms-2 px-0">
                            <select class="form-select" aria-label="mode" name="mode">
                              <option value=2>Descending</option>
                              <option value=1 <% if (search.mode === 1) { %> selected <% } %> >Ascending</option>
                            </select>
                          </div>
                          <div class="col-4">
                            <select class="form-select" aria-label="genre" name="genre">
                              <option value="none" <% if (!search.genre) { %> selected <% } %> >Genre (All)</option>
                              <option value="action" <% if (search.genre == 'action') { %> selected <% } %> >Action</option>
                              <option value="adventure" <% if (search.genre == 'adventure') { %> selected <% } %> >Adventure</option>
                              <option value="animation" <% if (search.genre == 'animation') { %> selected <% } %> >Animation</option>
                              <option value="comedy" <% if (search.genre == 'comedy') { %> selected <% } %> >Comedy</option>
                              <option value="drama" <% if (search.genre == 'drama') { %> selected <% } %> >Drama</option>
                              <option value="fantasy" <% if (search.genre == 'fantasy') { %> selected <% } %> >Fantasy</option>
                              <option value="horror" <% if (search.genre == 'horror') { %> selected <% } %> >Horror</option>
                              <option value="musical" <% if (search.genre == 'musical') { %> selected <% } %> >Musical</option>
                              <option value="mystery" <% if (search.genre == 'mystery') { %> selected <% } %> >Mystery</option>
                              <option value="romance" <% if (search.genre == 'romance') { %> selected <% } %> >Romance</option>
                              <option value="scifi" <% if (search.genre == 'scifi') { %> selected <% } %> >Sci-fi</option>
                              <option value="thriller" <% if (search.genre == 'thriller') { %> selected <% } %> >Thriller</option>
                              <option value="western" <% if (search.genre == 'western') { %> selected <% } %> >Western</option>
                            </select>
                          </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <%- include('../partials/pagebar.ejs') %>

        <table class="table table-striped bg-light">
            <tbody>
                <% if (movielist) { %> 
                    <% if (movielist.length == 0) { %> 
                        <tr><td>
                            <p class="fw-bold mx-4 my-2 text-center">
                                There are no result.
                            </p>
                        </tr></td>
                    <% } else { %> 
                        <% movielist.forEach(function(movie) { %>
                        <tr><td>

                            <a href="/movies/<%= movie._id %> " class='text-dark'>
                                <div class='row'>
                                    <div class='col-3 col-md-2'>
                                        <div class='d-flex justify-content-center'>
                                            <img src="<%= movie.image %>" alt="AAAAAAAA" height="120px">
                                        </div>
                                    </div>
                                    <div class='col-6 col-md-8'>
                                        <div class='fw-bold fs-2'><%= movie.moviename %></div>
                                        <div>
                                            <% if(helper.getAirDateColor(movie.airdate) == 0) { %> 
                                                <span style="color: black;"><i class="fas fa-film mf-auto me-1"></span></i>
                                            <% } else if (helper.getAirDateColor(movie.airdate) == 1) { %> 
                                                <span style="color: #dc3545;"><i class="fas fa-film mf-auto me-1"></span></i>
                                            <% } else { %> 
                                                <span style="color: #ffc107;"><i class="fas fa-film mf-auto me-1"></span></i>
                                            <% } %> 
                                            <%= helper.getShortDate(movie.airdate) %>
                                        </div>

                                        <div class="d-grid gap-2 d-flex justify-content-start">
                                            <p class="fw-light">
                                            <% if(!currentUser) {%>
                                                <i class="far fa-heart mf-auto me-2"></i><%= movie.likecount %>
                                            <% } else { %>
                                                
                                                <% if (helper.findLiked(currentUser.likedMovie, movie._id))  { %>
                                                    <span style="color: hotpink;"><i class="fas fa-heart mf-auto me-2 "></i></span><%= movie.likecount %>
                                                <% } else { %> 
                                                    <i class="far fa-heart mf-auto me-2"></i><%= movie.likecount %>
                                                <% } %>
                                            <% } %>
                                            </p>
                        
                                            <p class="fw-light">
                                                <i class="fas fa-star"></i>
                                                <% if (movie.avgrating == -1) { %> 
                                                -/10
                                                <% } else { %>  
                                                <%= (movie.avgrating).toFixed(1) %>/10
                                                <% } %> 
                                            </p>
                                        </div>

                                    </div>
                                    <div class='col-3 col-md-2'>
                                        <% if (movie.genre.length > 0) { %>
                                            <span class='fw-bold'>Genres: </span><%= helper.CapAndJoin(movie.genre) %>
                                        <% } else { %>
                                            <span class='fw-bold'>No Genres</span>
                                        <% } %>
                                        <div>
                                            <span class='fw-bold'>Length: </span><%= movie.length %> 
                                        </div>
                                    </div> 
                                </div>
                            </a>

                        </tr></td>
                        <% }); %> 
                    <% } %> 
                <% } %> 
            </tbody>
        </table>
    </div>

</div>

<%- include('../partials/footer.ejs') %>

